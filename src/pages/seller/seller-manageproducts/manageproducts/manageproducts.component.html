<div class="products-container">
  <app-sidebar></app-sidebar>

  <div class="main-content">
    <!-- Header -->
    <div class="header-container">
      <div class="header-title">
        <span class="menu-icon">
          <mat-icon>menu</mat-icon>
        </span>
        <span class="products-title">Products</span>
      </div>
    </div>

    <!-- Status Filters -->
    <div class="status-filter-container">
      <div class="status-label">STATUS:</div>
      <div class="status-pills">
        @for (status of statusFilters; track status) {
        <button
          class="pill-button"
          [class.active]="isStatusActive(status)"
          [class.active-orange]="isStatusActive(status)"
          (click)="toggleStatus(status)"
        >
          {{ status }}
          @if (isStatusActive(status)) {
          <mat-icon class="check-icon">check</mat-icon>
          }
        </button>
        }
      </div>
      <div class="import-export-container">
        <button
          class="btn-import-export"
          (click)="handleImportExport('export')"
        >
          <mat-icon class="import-icon">download</mat-icon>
          Export
        </button>
      </div>
    </div>

    <!-- Search and Filter Bar -->
    <div class="search-filter-container">
      <div class="search-box">
        <input
          type="text"
          [value]="searchSid()"
          (input)="onSearchSidChange($event)"
          placeholder="Search by Name"
          class="search-input"
        />
        <span class="search-icon">
          <mat-icon>search</mat-icon>
        </span>
      </div>
      <div class="search-box">
        <input
          type="text"
          class="search-input"
          [value]="searchSku()"
          (input)="onSearchSkuChange($event)"
          placeholder="Search by Product ID"
        />
        <mat-icon class="search-icon" *ngIf="!searchSku()">search</mat-icon>
        <mat-icon
          class="search-icon clear-icon"
          *ngIf="searchSku()"
          (click)="clearSearch('sku')"
        >
          clear
        </mat-icon>
      </div>
      <div class="dropdown-container">
        <div class="dropdown" (click)="toggleDropdown()">
          <div class="dropdown-header">
            <span class="dropdown-text">{{
              selectedCountry() || "Countries *"
            }}</span>
            <span class="dropdown-icon">
              <mat-icon>expand_more</mat-icon>
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Products Table -->
    <div class="table-container">
      @if (loading()) {
      <div class="loading">Loading products...</div>
      } @else if (error()) {
      <div class="error">{{ error() }}</div>
      } @else {
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              @for (header of tableHeaders; track header) {
              <th scope="col">{{ header }}</th>
              }
            </tr>
          </thead>
          <tbody>
            @if (filteredProducts().length) { @for (product of
            filteredProducts(); track product.productId) {
            <tr>
              <td class="align-middle">{{ product.name }}</td>
              <td class="align-middle">{{ product.productId }}</td>
              <td class="align-middle text-end numeric-value">
                {{ product.basePrice | currency }}
              </td>
              <td class="align-middle text-end numeric-value">
                {{ product.finalPrice | currency }}
              </td>
              <td class="align-middle">USD</td>
              <td class="align-middle">
                <span class="stock-info">
                  {{ product.stockQuantity }}
                  <i class="bi bi-info-circle ms-1"></i>
                </span>
              </td>
              <td class="align-middle">
                <span
                  class="badge rounded-pill"
                  [ngClass]="getStatusClass(product.approvalStatus)"
                >
                  {{ getStatusDisplay(product.approvalStatus) }}
                </span>
              </td>
              <td class="align-middle text-center">
                <span
                  class="availability-badge"
                  [ngClass]="getAvailabilityClass(product.isAvailable)"
                >
                  <i
                    class="bi"
                    [ngClass]="getAvailabilityIcon(product.isAvailable)"
                  ></i>
                  {{ getAvailabilityText(product.isAvailable) }}
                </span>
              </td>
              <td class="align-middle">
                <div class="action-buttons">
                  <button
                    class="btn btn-link btn-sm"
                    (click)="onEditProduct(product)"
                  >
                    <i class="bi bi-pencil-square"></i>
                  </button>
                  <button
                    class="btn btn-link btn-sm text-danger"
                    (click)="onDeleteProduct(product)"
                  >
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            } } @else {
            <tr>
              <td colspan="9" class="text-center py-4 text-muted">
                No products found!
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      <div
        class="pagination-wrapper d-flex justify-content-between align-items-center p-3 border-top"
      >
        <div class="text-muted small">
          Showing {{ pageSize() * currentPage() + 1 }} -
          {{ Math.min(pageSize() * (currentPage() + 1), totalItems()) }}
          of {{ totalItems() }} items
        </div>

        <div class="d-flex align-items-center gap-3">
          <div class="d-flex align-items-center gap-2">
            <span class="text-muted small">Items per page:</span>
            <select
              class="form-select form-select-sm w-auto"
              [value]="pageSize()"
              (change)="onPageSizeChange($event)"
            >
              <option value="5">5</option>
              <option value="10">10</option>
              <option value="20">20</option>
              <option value="50">50</option>
            </select>
          </div>

          <nav aria-label="Page navigation">
            <ul class="pagination pagination-sm mb-0">
              <li class="page-item" [class.disabled]="currentPage() === 0">
                <button class="page-link" (click)="onPageChange(0)">
                  <i class="bi bi-chevron-double-left"></i>
                </button>
              </li>
              <li class="page-item" [class.disabled]="currentPage() === 0">
                <button
                  class="page-link"
                  (click)="onPageChange(currentPage() - 1)"
                >
                  <i class="bi bi-chevron-left"></i>
                </button>
              </li>
              @for (page of getPages(); track page) {
              <li class="page-item" [class.active]="page === currentPage()">
                <button class="page-link" (click)="onPageChange(page)">
                  {{ page + 1 }}
                </button>
              </li>
              }
              <li
                class="page-item"
                [class.disabled]="currentPage() === totalPages() - 1"
              >
                <button
                  class="page-link"
                  (click)="onPageChange(currentPage() + 1)"
                >
                  <i class="bi bi-chevron-right"></i>
                </button>
              </li>
              <li
                class="page-item"
                [class.disabled]="currentPage() === totalPages() - 1"
              >
                <button
                  class="page-link"
                  (click)="onPageChange(totalPages() - 1)"
                >
                  <i class="bi bi-chevron-double-right"></i>
                </button>
              </li>
            </ul>
          </nav>
        </div>
      </div>
      }
    </div>
  </div>

  <!-- Language Selector -->
  <div class="language-selector" (click)="toggleLanguage()">
    <mat-icon>language</mat-icon>
    <span class="language-text">English</span>
    <mat-icon>expand_less</mat-icon>
  </div>
</div>
