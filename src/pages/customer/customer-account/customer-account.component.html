<div class="customer-account-container">
  <!-- Error/Success Messages -->
  <div *ngIf="errorMessage" class="alert alert-danger" [@fadeInOut]>{{ errorMessage }}</div>
  <div *ngIf="successMessage" class="alert alert-success" [@fadeInOut]>{{ successMessage }}</div>

  <div class="customer-account-layout">
    <!-- Sidebar Navigation -->
    <aside class="customer-sidebar" [class.active]="isMobileMenuOpen" [@slideIn]>
      <nav class="sidebar-nav">
        <!-- Profile Info -->
        <mat-card *ngIf="!loading.profile; else profileSkeleton" class="profile-info" [@fadeInOut]>
          <img
            [src]="profile?.profileImageUrl || 'assets/images/default-avatar.png'"
            alt="Profile Picture"
            class="profile-avatar"
            loading="lazy"
          />
          <div class="profile-details">
            <h3>{{ profile?.firstName }} {{ profile?.lastName }}</h3>
            <p>{{ profile?.email }}</p>
          </div>
        </mat-card>
        
        <ng-template #profileSkeleton>
          <div class="profile-info-skeleton">
            <div class="skeleton circle"></div>
            <div class="profile-details-skeleton">
              <div class="skeleton text-large"></div>
              <div class="skeleton text"></div>
            </div>
          </div>
        </ng-template>

        <!-- Navigation List -->
        <mat-nav-list class="nav-list">
          <a mat-list-item *ngFor="let item of sidebarItems" 
             (click)="switchSection(item.section)"
             [class.active]="activeSection === item.section"
             [@fadeInOut]>
            <mat-icon [fontSet]="'fas'" [fontIcon]="item.icon"></mat-icon>
            <span>{{ item.label }}</span>
            <span class="nav-count" *ngIf="item.count && item.count > 0">({{ item.count }})</span>
          </a>
          <mat-divider></mat-divider>
          <a mat-list-item (click)="logout()" class="logout">
            <mat-icon>logout</mat-icon>
            <span>Logout</span>
          </a>
        </mat-nav-list>
      </nav>
    </aside>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" (click)="toggleMobileMenu()" [@fadeInOut]>
      <mat-icon>{{ isMobileMenuOpen ? 'close' : 'menu' }}</mat-icon>
    </button>

    <!-- Main Content Area -->
    <main class="account-main-content" [@slideIn]>
      <h2 class="section-title">{{ getSectionTitle(activeSection) }}</h2>
      
      <ng-container [ngSwitch]="activeSection">
        <!-- Account Overview -->
        <section *ngSwitchCase="sections.overview" class="section content-section" [@fadeInOut]>
          <mat-card *ngIf="!loading.profile; else formSkeleton" class="profile-form-wrapper">
            <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
              <mat-form-field>
                <mat-label>First Name</mat-label>
                <input matInput formControlName="firstName">
              </mat-form-field>
              
              <mat-form-field>
                <mat-label>Last Name</mat-label>
                <input matInput formControlName="lastName">
              </mat-form-field>
              
              <mat-form-field>
                <mat-label>Phone Number</mat-label>
                <input matInput formControlName="phoneNumber">
              </mat-form-field>

              <button mat-raised-button color="primary" type="submit" [disabled]="!profileForm.valid || loading.profile">
                {{ loading.profile ? 'Updating...' : 'Update Profile' }}
              </button>
            </form>
          </mat-card>
        </section>

        <!-- Orders Section -->
        <section *ngSwitchCase="sections.orders" class="section content-section" [@fadeInOut]>
          <mat-card class="orders-list">
            <ng-container *ngIf="orders.length; else ordersSkeleton">
              <mat-card *ngFor="let order of orders" class="order-card">
                <mat-card-header>
                  <mat-card-title>Order #{{ order.orderId }}</mat-card-title>
                  <mat-card-subtitle>{{ order.orderDate | date }}</mat-card-subtitle>
                  <span class="order-status" [ngClass]="order.status.toLowerCase()">{{ order.status }}</span>
                </mat-card-header>
                <mat-card-content>
                  <p>Total Amount: {{ order.totalAmount | currency }}</p>
                </mat-card-content>
                <mat-card-actions>
                  <button mat-button color="primary" (click)="viewOrderDetails(order.orderId)">
                    <mat-icon>visibility</mat-icon> View Details
                  </button>
                </mat-card-actions>
              </mat-card>
            </ng-container>
          </mat-card>
        </section>

        <!-- Inbox Section -->
        <section *ngSwitchCase="sections.inbox" class="section content-section" [@fadeInOut]>
          <div class="messages-list">
            <div class="message-card" *ngFor="let message of assumedFeatures.messages" [class.unread]="!message.read">
              <div class="message-header">
                <span class="message-subject">{{ message.subject }}</span>
                <span class="message-date">{{ message.date | date }}</span>
              </div>
              <div class="message-preview">{{ message.content }}</div>
            </div>
          </div>
        </section>

        <!-- Pending Reviews Section -->
        <section *ngSwitchCase="sections.pendingReviews" class="section content-section" [@fadeInOut]>
          <div class="reviews-list">
            <div class="review-card" *ngFor="let review of assumedFeatures.pendingReviews">
              <img [src]="review.productImage" [alt]="review.productName" class="product-image" />
              <div class="review-details">
                <h4>{{ review.productName }}</h4>
                <p>Purchased on {{ review.purchaseDate | date }}</p>
                <button class="btn btn-primary" (click)="writeReview(review)">
                  <i class="fas fa-pen"></i> Write Review
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- Vouchers Section -->
        <section *ngSwitchCase="sections.vouchers" class="section content-section" [@fadeInOut]>
          <div class="vouchers-list">
            <div class="voucher-card" *ngFor="let voucher of assumedFeatures.vouchers">
              <div class="voucher-code">{{ voucher.code }}</div>
              <div class="voucher-details">
                <p>{{ voucher.description }}</p>
                <p class="expiry">Valid until {{ voucher.endDate | date }}</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Wishlist Section -->
        <section *ngSwitchCase="sections.wishlist" class="section content-section" [@fadeInOut]>
          <div class="wishlist-grid">
            <div class="product-card" *ngFor="let item of wishlist">
              <img [src]="item.product.imageUrl" [alt]="item.product.name" />
              <div class="product-info">
                <h4>{{ item.product.name }}</h4>
                <p class="price">{{ item.product.price | currency }}</p>
                <div class="product-actions">
                  <button class="btn btn-outline" (click)="moveToCart(item.wishlistId)">
                    <i class="fas fa-shopping-cart"></i> Move to Cart
                  </button>
                  <button class="btn btn-danger" (click)="removeFromWishlist(item.wishlistId)">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <nav class="pagination" role="navigation" aria-label="Pagination Navigation">
            <button 
              class="btn btn-outline" 
              (click)="changeWishlistPage(wishlistCurrentPage - 1)" 
              [disabled]="wishlistCurrentPage === 1"
              aria-label="Go to previous page"
              (keydown.enter)="changeWishlistPage(wishlistCurrentPage - 1)"
              [attr.aria-disabled]="wishlistCurrentPage === 1">
              <i class="fas fa-chevron-left" aria-hidden="true"></i>
              <span>Previous</span>
            </button>
            
            <span aria-current="page" role="status">
              Page {{ wishlistCurrentPage }} of {{ wishlistTotalPages }}
            </span>
            
            <button 
              class="btn btn-outline" 
              (click)="changeWishlistPage(wishlistCurrentPage + 1)" 
              [disabled]="wishlistCurrentPage === wishlistTotalPages"
              aria-label="Go to next page"
              (keydown.enter)="changeWishlistPage(wishlistCurrentPage + 1)"
              [attr.aria-disabled]="wishlistCurrentPage === wishlistTotalPages">
              <span>Next</span>
              <i class="fas fa-chevron-right" aria-hidden="true"></i>
            </button>
          </nav>
        </section>

        <!-- Address Book Section -->
        <section *ngSwitchCase="sections.addressBook" class="section content-section" [@fadeInOut]>
          <div class="address-section">
            <div class="address-form">
              <h3>Add New Address</h3>
              <form [formGroup]="addressForm" (ngSubmit)="addAddress()">
                <div class="form-group">
                  <label for="addressName">Address Name</label>
                  <input id="addressName" type="text" formControlName="addressName" class="form-control" />
                </div>
                <div class="form-group">
                  <label for="streetAddress">Street Address</label>
                  <input id="streetAddress" type="text" formControlName="streetAddress" class="form-control" />
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="city">City</label>
                    <input id="city" type="text" formControlName="city" class="form-control" />
                  </div>
                  <div class="form-group">
                    <label for="state">State</label>
                    <input id="state" type="text" formControlName="state" class="form-control" />
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="postalCode">Postal Code</label>
                    <input id="postalCode" type="text" formControlName="postalCode" class="form-control" />
                  </div>
                  <div class="form-group">
                    <label for="country">Country</label>
                    <input id="country" type="text" formControlName="country" class="form-control" />
                  </div>
                </div>
                <div class="form-group">
                  <label for="addressPhone">Phone Number</label>
                  <input id="addressPhone" type="tel" formControlName="phoneNumber" class="form-control" />
                </div>
                <div class="form-check">
                  <input id="isDefault" type="checkbox" formControlName="isDefault" />
                  <label for="isDefault">Set as default address</label>
                </div>
                <button type="submit" [disabled]="!addressForm.valid || loading.addresses" class="btn btn-primary">
                  {{ loading.addresses ? 'Adding...' : 'Add Address' }}
                </button>
              </form>
            </div>
            <div class="addresses-list">
              <div class="address-card" *ngFor="let address of addresses" [class.default]="address.isDefault">
                <div class="address-header">
                  <h4>{{ address.addressName }}</h4>
                  <span *ngIf="address.isDefault" class="default-badge">Default</span>
                </div>
                <div class="address-details">
                  <p>{{ address.streetAddress }}</p>
                  <p>{{ address.city }}, {{ address.state }} {{ address.postalCode }}</p>
                  <p>{{ address.country }}</p>
                  <p>{{ address.phoneNumber }}</p>
                </div>
                <div class="address-actions">
                  <button class="btn btn-outline" (click)="editAddress(address)">
                    <i class="fas fa-edit"></i> Edit
                  </button>
                  <button class="btn btn-danger" (click)="deleteAddress(address.addressId)">
                    <i class="fas fa-trash-alt"></i> Delete
                  </button>
                </div>
              </div>
            </div>
            <nav class="pagination" role="navigation" aria-label="Pagination Navigation">
              <button 
                class="btn btn-outline" 
                (click)="changePage(currentPage - 1)" 
                [disabled]="currentPage === 1"
                aria-label="Go to previous page"
                (keydown.enter)="changePage(currentPage - 1)"
                [attr.aria-disabled]="currentPage === 1">
                <i class="fas fa-chevron-left" aria-hidden="true"></i>
                <span>Previous</span>
              </button>
              
              <span aria-current="page" role="status">
                Page {{ currentPage }} of {{ totalPages }}
              </span>
              
              <button 
                class="btn btn-outline" 
                (click)="changePage(currentPage + 1)" 
                [disabled]="currentPage === totalPages"
                aria-label="Go to next page"
                (keydown.enter)="changePage(currentPage + 1)"
                [attr.aria-disabled]="currentPage === totalPages">
                <span>Next</span>
                <i class="fas fa-chevron-right" aria-hidden="true"></i>
              </button>
            </nav>
          </div>
        </section>

        <!-- Newsletter Preferences Section -->
        <section *ngSwitchCase="sections.newsletter" class="section content-section" [@fadeInOut]>
          <div class="newsletter-preferences">
            <h3>Email Preferences</h3>
            <div class="subscription-toggle">
              <label>
                <input type="checkbox" [checked]="assumedFeatures.newsletter.subscribed" (change)="toggleNewsletter($event)" />
                Receive email notifications
              </label>
            </div>
            <div class="preferences-form" *ngIf="assumedFeatures.newsletter.subscribed">
              <h4>I want to receive emails about:</h4>
              <div class="checkbox-group">
                <label>
                  <input type="checkbox" [checked]="true" />
                  Deals and Promotions
                </label>
                <label>
                  <input type="checkbox" [checked]="true" />
                  New Arrivals
                </label>
                <label>
                  <input type="checkbox" [checked]="true" />
                  My Orders
                </label>
              </div>
            </div>
          </div>
        </section>

        <!-- Close Account Section -->
        <section *ngSwitchCase="sections.closeAccount" class="section content-section" [@fadeInOut]>
          <div class="close-account-section">
            <h3>Close Your Account</h3>
            <div class="warning-message">
              <i class="fas fa-exclamation-triangle"></i>
              <p>Warning: This action cannot be undone. Once you close your account:</p>
              <ul>
                <li>You will lose access to your order history</li>
                <li>Your wishlist will be deleted</li>
                <li>Your saved addresses will be removed</li>
                <li>You won't be able to use this email to create a new account</li>
              </ul>
            </div>
            <button class="btn btn-danger" (click)="requestAccountClosure()">
              <i class="fas fa-user-slash"></i> Close Account Permanently
            </button>
          </div>
        </section>

        <!-- Recently Viewed Section -->
        <section *ngSwitchCase="'recentlyViewed'" class="section content-section" [@fadeInOut]>
          <div class="products-grid">
            <div class="product-card" *ngFor="let product of assumedFeatures.recentlyViewed">
              <img [src]="product.imageUrl" [alt]="product.name" loading="lazy" />
              <div class="product-info">
                <h4>{{ product.name }}</h4>
                <p class="price">{{ product.price | currency }}</p>
                <p class="viewed-at">Viewed {{ product.viewedAt | date:'shortDate' }}</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Followed Sellers Section -->
        <section *ngSwitchCase="'followedSellers'" class="section content-section" [@fadeInOut]>
          <div class="sellers-grid">
            <div class="seller-card" *ngFor="let seller of assumedFeatures.followedSellers">
              <img [src]="seller.businessLogo" [alt]="seller.businessName" class="seller-logo" loading="lazy" />
              <div class="seller-info">
                <h4>{{ seller.businessName }}</h4>
                <div class="seller-stats">
                  <span class="rating">
                    <i class="fas fa-star"></i> {{ seller.rating }}
                  </span>
                  <span class="products">{{ seller.productCount }} Products</span>
                </div>
                <p class="following-since">Following since {{ seller.followedSince | date:'mediumDate' }}</p>
                <button class="btn btn-outline-danger" (click)="unfollowSeller(seller.sellerId)">
                  <i class="fas fa-user-minus"></i> Unfollow
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- Fallback Content (Optional) -->
        <ng-container *ngSwitchDefault>
          <!-- Optionally display default or empty state content -->
        </ng-container>
      </ng-container>

      <!-- Skeleton Templates -->
      <ng-template #formSkeleton>
        <div class="form-skeleton">
          <div class="skeleton form-field"></div>
          <div class="skeleton form-field"></div>
          <div class="skeleton form-field"></div>
          <div class="skeleton button"></div>
        </div>
      </ng-template>

      <ng-template #ordersSkeleton>
        <div class="orders-skeleton">
          <div class="skeleton card"></div>
          <div class="skeleton card"></div>
          <div class="skeleton card"></div>
        </div>
      </ng-template>

      <ng-template #addressesSkeleton>
        <div class="addresses-skeleton">
          <div class="skeleton card"></div>
          <div class="skeleton card"></div>
          <div class="skeleton card"></div>
        </div>
      </ng-template>

      <ng-template #profileSkeleton>
        <div class="profile-info-skeleton">
          <div class="skeleton circle"></div>
          <div class="profile-details-skeleton">
            <div class="skeleton text-large"></div>
            <div class="skeleton text"></div>
          </div>
        </div>
      </ng-template>
    </main>
  </div>
</div>
